void joy()
{
   PlayTone(TONE_E4, MS_100);
   Wait(MS_100);
   PlayTone(TONE_G4, MS_100);
   Wait(MS_100);
   PlayTone(TONE_C5, MS_100);
   Wait(MS_100);
   PlayTone(TONE_E5, MS_100);
   Wait(MS_100);
   PlayTone(TONE_G5, MS_300);
   Wait(MS_300);
   PlayTone(TONE_E5, MS_100);
   Wait(MS_100);
   PlayTone(TONE_G5, SEC_1);
   Wait(SEC_1);
}
void sadness()
{
   PlayTone(TONE_C5, MS_500);
   Wait(MS_500);
   PlayTone(TONE_B4, MS_500);
   Wait(MS_500);
   PlayTone(TONE_AS4, MS_500);
   Wait(MS_500);
   repeat (10)
   {
   PlayTone(TONE_A4, MS_50);
   Wait(MS_50);
   PlayTone(TONE_AS4, MS_50);
   Wait(MS_50);
   }
   PlayTone(TONE_A4, MS_200);
   Wait(MS_200);
}

task mario()
{
 while(true)
 {
PlayTone(TONE_E5,MS_100);
Wait(MS_150);
PlayTone(TONE_E5,MS_100);
Wait(MS_300);
PlayTone(TONE_E5,MS_100);
Wait(MS_300);
PlayTone(TONE_C5,MS_100);
Wait(MS_100);
PlayTone(TONE_E5,MS_100);
Wait(MS_300);
PlayTone(TONE_G5,MS_100);
Wait(MS_500);
PlayTone(TONE_G4,MS_100);
Wait(MS_600);
PlayTone(TONE_C5,MS_100);
Wait(MS_450);
PlayTone(TONE_G4,MS_100);
Wait(MS_400);
PlayTone(TONE_E4,MS_100);
Wait(MS_500);
PlayTone(TONE_A4,MS_100);
Wait(MS_300);
PlayTone(TONE_B4,MS_80);
Wait(MS_350);
PlayTone(TONE_AS4,MS_100);
Wait(MS_150);
PlayTone(TONE_A4,MS_100);
Wait(MS_300);
PlayTone(TONE_G4,MS_100);
Wait(MS_200);
PlayTone(TONE_E5,MS_80);
Wait(MS_200);
PlayTone(TONE_G5,MS_50);
Wait(MS_150);
PlayTone(TONE_A5,MS_100);
Wait(MS_300);
PlayTone(TONE_F5,MS_80);
Wait(MS_150);
PlayTone(TONE_G5,MS_50);
Wait(MS_350);
PlayTone(TONE_E5,MS_80);
Wait(MS_300);
PlayTone(TONE_C5,MS_80);
Wait(MS_150);
PlayTone(TONE_D5,MS_80);
Wait(MS_150);
PlayTone(TONE_B4,MS_80);
Wait(MS_500);

PlayTone(TONE_C5,MS_100);
Wait(MS_450);
PlayTone(TONE_G4,MS_100);
Wait(MS_400);
PlayTone(TONE_E4,MS_100);
Wait(MS_500);
PlayTone(TONE_A4,MS_100);
Wait(MS_300);
PlayTone(TONE_B4,MS_80);
Wait(MS_350);
PlayTone(TONE_AS4,MS_100);
Wait(MS_150);
PlayTone(TONE_A4,MS_100);
Wait(MS_300);
PlayTone(TONE_G4,MS_100);
Wait(MS_200);
PlayTone(TONE_E5,MS_80);
Wait(MS_200);
PlayTone(TONE_G5,MS_50);
Wait(MS_150);
PlayTone(TONE_A5,MS_100);
Wait(MS_300);
PlayTone(TONE_F5,MS_80);
Wait(MS_150);
PlayTone(TONE_G5,MS_50);
Wait(MS_350);
PlayTone(TONE_E5,MS_80);
Wait(MS_300);
PlayTone(TONE_C5,MS_80);
Wait(MS_150);
PlayTone(TONE_D5,MS_80);
Wait(MS_150);
PlayTone(TONE_B4,MS_80);
Wait(MS_500);

PlayTone(TONE_C4,MS_100);
Wait(MS_300);
PlayTone(TONE_G5,MS_100);
Wait(MS_100);
PlayTone(TONE_FS5,MS_100);
Wait(MS_150);
PlayTone(TONE_F5,MS_100);
Wait(MS_150);
PlayTone(TONE_DS5,MS_150);
Wait(MS_300);
PlayTone(TONE_E5,MS_150);
Wait(MS_300);
PlayTone(TONE_G4,MS_100);
Wait(MS_150);
PlayTone(TONE_A4,MS_100);
Wait(MS_150);

PlayTone(TONE_C5,MS_100);
Wait(MS_300);
PlayTone(TONE_A4,MS_100);
Wait(MS_150);
PlayTone(TONE_C5,MS_100);
Wait(MS_100);
PlayTone(TONE_D5,MS_100);
Wait(MS_200);

PlayTone(TONE_C4,MS_100);
Wait(MS_300);

PlayTone(TONE_G5,MS_100);
Wait(MS_100);
PlayTone(TONE_FS5,MS_100);
Wait(MS_150);
PlayTone(TONE_F5,MS_100);
Wait(MS_150);
PlayTone(TONE_DS5,MS_150);
Wait(MS_300);

PlayTone(TONE_E5,MS_200);
Wait(MS_300);

PlayTone(TONE_C6,MS_80);
Wait(MS_300);
PlayTone(TONE_C6,MS_80);
Wait(MS_150);
PlayTone(TONE_C6,MS_80);
Wait(MS_300);

PlayTone(TONE_G4,MS_100);
Wait(MS_300);
PlayTone(TONE_C4,MS_100);
Wait(MS_300);

PlayTone(TONE_G5,MS_100);
Wait(MS_100);
PlayTone(TONE_FS5,MS_100);
Wait(MS_150);
PlayTone(TONE_F5,MS_100);
Wait(MS_150);
PlayTone(TONE_DS5,MS_150);
Wait(MS_300);

PlayTone(TONE_E5,MS_150);
Wait(MS_300);
PlayTone(TONE_G4,MS_100);
Wait(MS_150);
PlayTone(TONE_A4,MS_100);
Wait(MS_150);

PlayTone(TONE_C5,MS_100);
Wait(MS_300);
PlayTone(TONE_A4,MS_100);
Wait(MS_150);
PlayTone(TONE_C5,MS_100);
Wait(MS_100);
PlayTone(TONE_D5,MS_100);
Wait(MS_400);

PlayTone(TONE_DS5,MS_100);
Wait(MS_450);

PlayTone(TONE_D5,MS_100);
Wait(MS_400);

PlayTone(TONE_C5,MS_100);
Wait(MS_450);

PlayTone(TONE_G4,MS_100);
Wait(MS_150);
PlayTone(TONE_G4,MS_100);
Wait(MS_300);
PlayTone(TONE_C4,MS_100);
Wait(MS_300);
PlayTone(TONE_C4,MS_100);
Wait(MS_300);

PlayTone(TONE_G5,MS_100);
Wait(MS_100);
PlayTone(TONE_FS5,MS_100);
Wait(MS_150);
PlayTone(TONE_F5,MS_100);
Wait(MS_150);
PlayTone(TONE_DS5,MS_150);
Wait(MS_300);

PlayTone(TONE_E5,MS_150);
Wait(MS_300);
PlayTone(TONE_G4,MS_100);
Wait(MS_150);
PlayTone(TONE_A4,MS_100);
Wait(MS_150);

PlayTone(TONE_C5,MS_100);
Wait(MS_300);
PlayTone(TONE_A4,MS_100);
Wait(MS_150);
PlayTone(TONE_C5,MS_100);
Wait(MS_100);
PlayTone(TONE_D5,MS_100);
Wait(MS_200);

PlayTone(TONE_C4,MS_100);
Wait(MS_300);

PlayTone(TONE_G5,MS_100);
Wait(MS_100);
PlayTone(TONE_FS5,MS_100);
Wait(MS_150);
PlayTone(TONE_F5,MS_100);
Wait(MS_150);
PlayTone(TONE_DS5,MS_150);
Wait(MS_300);

PlayTone(TONE_E5,MS_200);
Wait(MS_300);

PlayTone(TONE_C6,MS_80);
Wait(MS_300);
PlayTone(TONE_C6,MS_80);
Wait(MS_150);
PlayTone(TONE_C6,MS_80);
Wait(MS_300);

PlayTone(TONE_G4,MS_100);
Wait(MS_300);
PlayTone(TONE_C4,MS_100);
Wait(MS_300);

PlayTone(TONE_G5,MS_100);
Wait(MS_100);
PlayTone(TONE_FS5,MS_100);
Wait(MS_150);
PlayTone(TONE_F5,MS_100);
Wait(MS_150);
PlayTone(TONE_DS5,MS_150);
Wait(MS_300);

PlayTone(TONE_E5,MS_150);
Wait(MS_300);
PlayTone(TONE_G4,MS_100);
Wait(MS_150);
PlayTone(TONE_A4,MS_100);
Wait(MS_150);

PlayTone(TONE_C5,MS_100);
Wait(MS_300);
PlayTone(TONE_A4,MS_100);
Wait(MS_150);
PlayTone(TONE_C5,MS_100);
Wait(MS_100);
PlayTone(TONE_D5,MS_100);
Wait(MS_400);

PlayTone(TONE_DS5,MS_100);
Wait(MS_450);

PlayTone(TONE_D5,MS_100);
Wait(MS_400);

PlayTone(TONE_C5,MS_100);
Wait(MS_450);

PlayTone(TONE_G4,MS_100);
Wait(MS_150);
PlayTone(TONE_G4,MS_100);
Wait(MS_300);
PlayTone(TONE_C4,MS_100);
Wait(MS_300);

PlayTone(TONE_C5,MS_60);
Wait(MS_150);
PlayTone(TONE_C5,MS_80);
Wait(MS_300);
PlayTone(TONE_C5,MS_60);
Wait(MS_350);
PlayTone(TONE_C5,MS_80);
Wait(MS_150);
PlayTone(TONE_D5,MS_80);
Wait(MS_350);
PlayTone(TONE_E5,MS_80);
Wait(MS_150);
PlayTone(TONE_C5,MS_80);
Wait(MS_300);
PlayTone(TONE_A4,MS_80);
Wait(MS_150);
PlayTone(TONE_G4,MS_80);
Wait(MS_600);

PlayTone(TONE_C5,MS_60);
Wait(MS_150);
PlayTone(TONE_C5,MS_80);
Wait(MS_300);
PlayTone(TONE_C5,MS_60);
Wait(MS_350);
PlayTone(TONE_C5,MS_80);
Wait(MS_150);
PlayTone(TONE_D5,MS_80);
Wait(MS_150);
PlayTone(TONE_E5,MS_80);
Wait(MS_500);

PlayTone(TONE_A5,MS_80);
Wait(MS_350);
PlayTone(TONE_G5,MS_80);
Wait(MS_600);

PlayTone(TONE_C5,MS_60);
Wait(MS_150);
PlayTone(TONE_C5,MS_80);
Wait(MS_300);
PlayTone(TONE_C5,MS_60);
Wait(MS_350);
PlayTone(TONE_C5,MS_80);
Wait(MS_150);
PlayTone(TONE_D5,MS_80);
Wait(MS_350);
PlayTone(TONE_E5,MS_80);
Wait(MS_150);
PlayTone(TONE_C5,MS_80);
Wait(MS_300);
PlayTone(TONE_A4,MS_80);
Wait(MS_150);
PlayTone(TONE_G4,MS_80);
Wait(MS_600);
 }
}

void GoFront()
{
   OnRev(OUT_AC,25);
}

void CloseTrap()
{
   OnFwd(OUT_B,25);
}

void OpenTrap()
{
   OnRev(OUT_B,25);
}

void GoBack()
{
   OnFwd(OUT_B,25);
}

void TurnRight(int angle)
{
   OnFwd(OUT_A,50);
   OnRev(OUT_C,50);
   Wait(60*angle);
}

void TurnLeft(int angle)
{
   OnFwd(OUT_C,50);
   OnRev(OUT_A,50);
   Wait(60*angle);
}



int touch()
{
   SetSensorTouch(IN_2);
   SetSensorTouch(IN_3);
   if(SENSOR_2 && !SENSOR_3) return 1;
   else if(!SENSOR_2 && SENSOR_3) return 2;
   else if(SENSOR_2 && SENSOR_3) return 3;
   else return 0;

}

int distance()
{
    SetSensorUltrasonic(IN_4);
    int list[];
    ArrayInit(list, 0, 5);
    int cpt = 0;
    int ok = 0;
    while(list[4]==0)
    {
           list[cpt]=SensorUS(IN_4);
           if(list[cpt]<=8) ok++;
           Wait(100);
           cpt++;
    }
    if(ok>=3) return 1;
    else return 0;

}

task catch()
{
   SetSensorUltrasonic(IN_4);
   while(true)
   {
    if(touch()==0)
    {
      int i = SensorUS(IN_4);
      TextOut(0,0,NumToStr(i));
      Wait(200);
      ClearScreen();
      NumOut(0,0,SensorUS(IN_4));
      if(i<10)
      {
         Off(OUT_AC);
         OnFwd(OUT_B,25);
         if(distance()==1)
         {
             joy();
             break;
         }
      }
      else
      {
         OnRev(OUT_AC,25);
         OnRev(OUT_B,25);
      }
    }
    else
    {
         OnRev(OUT_B,25);
         if(touch()==1)
         {
           TurnLeft(90);
         }
         else if(touch()==2)
         {
           TurnRight(90);
         }
         else
         {
           GoBack();
           TurnLeft(90);
         }
    }
   }
}

task search()
{
 TurnRight(90);
}

task main()
{
   Precedes(catch);
   
}


